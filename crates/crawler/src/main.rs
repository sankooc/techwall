use std::{fs::{self}, io::Write};

use anyhow::{Ok, Result};
use flate2::Compression;
use serde::Serialize;
use flate2::write::GzEncoder;
#[warn(dead_code)]
fn get_path(name: &str) -> String {
    let home = std::env::home_dir().unwrap().display().to_string();
    format!("{}/{}", home, name)
}
fn get_svg_bytes(name: &str) -> Result<Vec<u8>> {
    let root = get_path("repo/geticon/icons");
    let path = format!("{}/{}.svg", root, name);
    let content = std::fs::read(path)?;
    Ok(content)
}

#[derive(Serialize)]
pub struct Point {
    x: u32,
    y: u32,
}

impl From<(u32, u32)> for Point {
    fn from((x, y): (u32, u32)) -> Self {
        Point { x, y }
    }
}
#[derive(Serialize)]
pub struct Meta {
    name: String,
    width: u32,
    height: u32,
    scale: f32,
    polygon: Vec<Point>,
}

#[derive(Serialize)]
pub struct MetaData {
    items: Vec<Meta>,
}
fn main() {

    let target = get_path("repo/techwall/front/public/resource");
    let list = ["javascript", "python", "react", "nodejs-icon", "nodejs", "java", "typescript-icon", "typescript", "docker-icon", "docker", "android-icon", "android", "php", "mongodb-icon", "mongodb", "nextjs-icon", "nextjs", "tailwindcss-icon", "tailwindcss", "express", "mysql", "bootstrap", "c", "django-logo", "django", "redux", "go", "rust", "flutter", "angular-icon", "angular", "firebase-logo", "firebase", "postgresql-logo", "postgresql", "vue", "kotlin", "git-icon", "git", "flask", "ios", "laravel", "swift", "aws", "github-icon", "github", "json", "jquery-icon", "jquery", "dart", "arduino", "pytorch", "sass", "dotnet", "ruby", "tensorflow", "pandas-icon", "pandas-logo", "kubernetes", "vite", "discord-logo", "discord", "unity", "graphql", "webpack-logo", "webpack", "react-router", "spring-logo", "spring", "material-ui", "opencv", "bash-logo", "bash", "terraform-logo", "terraform", "numpy-icon", "numpy-logo", "redis", "wordpress-icon", "wordpress", "ethereum", "markdown", "ansible", "npm-logo", "npm", "macOS", "jamstack-icon", "jamstack", "maven", "jest", "raspberry-pi", "stackbit-icon", "stackbit", "azure-icon", "azure", "sqlite", "es6", "heroku-icon", "heroku", "lua", "nestjs", "eslint", "gatsby-logo", "gatsby", "scala", "electron", "selenium", "telegram", "nginx-icon", "nginx", "prisma", "vercel-logo", "vercel", "websocket", "terminal", "serverless", "opengl", "vim", "youtube-logo", "youtube", "rails", "expo-logo", "expo", "kafka-icon", "kafka", "rest", "svelte-icon", "svelte", "jekyll", "bitcoin", "gradle", "c-sharp", "twitter", "swagger", "netlify", "threejs", "haskell-icon", "haskell", "neovim", "ubuntu", "elasticsearch", "figma", "hugo-icon", "hugo", "babel", "hibernate", "rabbitmq-logo", "rabbitmq", "spark", "gulp", "qt", "svg", "assembly", "sequelize", "awesome", "symfony", "prettier", "prometheus", "component", "nuxt-icon", "nuxt", "chrome", "opensource", "stripe", "jenkins", "webgl", "deno", "visual-studio", "slack-icon", "slack", "ffmpeg-icon", "ffmpeg-logo", "emacs", "julia", "instagram-icon", "instagram", "tableau-icon", "tableau", "postman", "clojure", "objective-c", "webrtc", "grafana", "storybook-icon", "storybook", "composer", "debian", "nodemon", "uikit", "ionic-logo", "ionic", "jupyter", "webassembly", "yarn", "vagrant-logo", "vagrant", "cypress", "bluetooth", "facebook-logo", "facebook", "perl", "puppeteer", "oracle", "udacity", "d3", "apache", "cloudinary", "handlebars", "cloudflare", "xamarin", "apple", "firefox", "mariadb-icon", "mariadb", "wifi", "font-awesome", "redux-saga", "archlinux", "twitch-logo", "twitch", "visual-studio-code", "mern", "coursera", "reddit-icon", "reddit", "blender", "mocha", "whatsapp", "gsap", "travis-ci", "steam", "pug", "homebrew", "elm", "hadoop", "atom-logo", "atom", "fastify-icon", "fastify", "ant-design", "flow", "postcss", "gitlab", "oauth", "codeigniter-logo", "codeigniter", "solid", "hexo", "erlang", "wechat-logo", "wechat", "fabric", "compose", "cucumber", "passport", "hack", "delphi", "formik", "ocaml", "neo4j", "eclipse-logo", "eclipse", "cocoapods", "slides", "batch", "mobx", "salesforce", "cordova", "bulma", "airflow", "circleci", "less", "udemy-logo", "udemy", "vulkan", "mapbox-logo", "mapbox", "wikipedia", "drupal-icon", "drupal", "auth0", "magento", "openshift", "koa", "sanity", "chai", "twilio-logo", "twilio", "influxdb", "fsharp", "webcomponents", "bem", "phoenix", "rsa", "kibana", "rollup", "deploy", "contentful", "semantic-ui", "jira", "cassandra", "drone-logo", "drone", "packer", "woocommerce-logo", "woocommerce", "crystal", "platformio", "netflix-icon", "netflix", "preact", "tomcat", "loader", "letsencrypt", "strapi-logo", "strapi", "mdx", "gnome", "vault-logo", "vault", "webdev-icon", "webdev", "centos-icon", "centos", "shopify", "adobe", "netbeans", "parse", "tor", "quarkus-icon", "quarkus", "materializecss", "stylelint", "linkedin-icon", "linkedin", "akka", "gunicorn", "meteor-icon", "meteor", "gcc", "lodash", "consul", "fedora", "puppet-icon", "puppet", "ibm", "xampp", "momentjs", "stylus", "livewire", "enzyme", "flux", "alpinejs-logo", "alpinejs", "logstash", "ember", "knex", "promises", "sinatra", "webhooks", "sonarqube", "tiktok-logo", "tiktok", "mastodon-icon", "mastodon", "chromium", "heap", "sketch", "relay", "polymer", "haxe", "semantic-web", "jasmine", "chef", "openstack-logo", "openstack", "freebsd", "immutable", "sendgrid-logo", "sendgrid", "sentry-logo", "sentry", "joomla", "dialogflow", "intellij-idea", "pycharm", "line", "appium", "airbnb", "jetbrains", "paypal", "stackoverflow-icon", "stackoverflow", "mediawiki", "lumen", "trello", "realm", "grunt", "typo3-icon", "typo3", "coffeescript", "mit", "pixijs", "esbuild", "zoom-icon", "zoom-logo", "io", "signal", "karma", "doctrine", "solr", "vaadin", "pusher-logo", "pusher", "craftcms", "yandex-logo", "ghost", "reasonml-icon", "reasonml", "pm2", "docusaurus", "swoole", "medium-logo", "medium", "bitbucket", "hapi", "bower", "purescript-icon", "purescript", "splunk", "buffer", "dropbox", "nativescript", "kde", "progress", "memcached", "yeoman", "couchdb-icon", "couchdb", "highcharts", "semaphore", "lastfm", "redhat-logo", "redhat", "certbot", "blueprint", "etcd", "soundcloud", "teamwork-icon", "teamwork", "prestashop", "marvel", "mono", "insomnia", "jade", "rubygems", "foundation", "monero", "cakephp-logo", "cakephp", "gnu", "atomic-logo", "atomic", "codecademy", "hbase", "algolia", "saltstack", "qq", "editorconfig", "openlayers", "glitch-icon", "glitch", "lucene", "slim", "lighthouse", "element", "kali-logo", "datadog", "airtable", "vlang", "bing", "rancher-logo", "rancher", "now", "mailchimp", "mattermost-logo", "mattermost", "opencart", "blogger", "browsersync", "codecov", "loopback-icon", "loopback", "rubocop", "play", "yii", "flight", "hyper", "browserify-icon", "browserify", "kong-logo", "kong", "phonegap", "prismic-icon", "prismic", "zigbee", "nomad", "hasura", "mozilla", "mlab", "immer", "fastlane", "codepen-icon", "codepen", "react-spring", "box", "chalk", "safari", "webkit", "mailgun-icon", "mailgun", "bsd", "phpstorm", "flickr", "couchbase", "phantomjs", "alipay-logo", "alipay", "amp-icon", "amp", "autoprefixer", "grav", "neat", "ifttt", "gimp", "baidu-logo", "baidu", "ieee", "wildfly", "backbone-icon", "backbone", "libreoffice-icon", "libreoffice-logo", "leveldb", "compass", "todomvc", "moon", "openid-icon", "openid-logo", "aurora", "kirby-logo", "kirby", "confluence", "vuetifyjs", "wagtail", "atlassian", "sapper-icon", "ink", "gridsome-icon", "gridsome", "aurelia", "pinterest", "xstate", "jhipster-logo", "jhipster", "bitrise-icon", "bitrise", "sidekiq-logo", "sidekiq", "graphene", "inkscape", "vimeo-icon", "vimeo", "w3c", "asciidoctor", "rethinkdb", "snowpack", "phalcon", "uwsgi", "gleam", "concourse", "node-sass", "zeit-icon", "zeit", "tumblr-icon", "tumblr", "v8", "gwt", "altair", "snapchat", "ava", "graylog-logo", "graylog", "surge", "autoit", "todoist-icon", "todoist", "codesandbox", "workbox-icon", "workbox", "mesos", "flarum", "grails", "zend-framework", "redux-observable", "clion", "ramda", "middleman", "coveralls", "devto", "dojo-icon", "dojo", "arangodb", "opera", "alfresco", "dyndns", "pkg", "wikimedia", "brotli", "duckduckgo", "kraken", "segment-logo", "segment", "chakra-icon", "chakra-logo", "appveyor", "beats", "reactivex", "framework7-logo", "framework7", "square", "webstorm", "feathersjs", "bitwarden-logo", "bitwarden", "riot", "pouchdb", "dcos-logo", "dcos", "linode", "yahoo", "require", "jss", "cpanel", "linux-mint", "rocksdb", "metabase", "facebook-messenger", "jsdom", "gravatar", "stimulus", "gopher", "hyperapp", "zendesk-logo", "zendesk", "alibaba", "apache-camel", "datocms-icon", "datocms", "tencent", "hubspot", "brackets", "zhihu", "dribbble-icon", "dribbble", "visa", "haiku-logo", "haiku", "1password-logo", "1password", "thunderbird", "raml", "processwire-logo", "processwire", "mithril", "wearos", "discover", "bluemix", "refactor", "dat", "7zip", "panda", "capistrano", "oshw", "balena", "coreos-icon", "coreos", "onesignal", "skype", "wakatime", "brave-logo", "brave", "webtorrent", "disqus", "buildkite-icon", "buildkite", "hashnode-logo", "hashnode", "origami", "snyk", "appcelerator", "nsis", "dropzone", "vultr-icon", "vultr", "modx-logo", "modx", "quora", "webflow", "evernote-icon", "evernote-logo", "jquery-mobile", "mdn", "derby", "nightwatch", "codeclimate", "presto", "manuscript", "open-graph", "mega-logo", "mega", "subversion", "codebase", "sensu-logo", "sensu", "elo", "wix", "horizon", "cloudera", "akamai", "cyclejs", "adonis-icon", "adonis", "codeception", "envoyproxy", "void", "wire", "zapier-logo", "zapier", "haml", "qlik", "spinnaker", "crashlytics", "juju", "knockout", "mercurial", "zwave", "q", "zoho", "undertow", "drift", "fly", "kops", "pushbullet", "asana", "bamboo", "jruby", "sails", "suse", "aerospike-logo", "aerospike", "patreon", "apigee", "bugsnag-logo", "bugsnag", "brunch", "kickstarter-logo", "kickstarter", "statuspage", "cloudant", "looker-icon", "looker", "origin", "cockpit", "imagemin", "cljs", "createjs", "hhvm", "kaios", "namecheap", "hanami", "grommet", "intercom-logo", "intercom", "rollbar-logo", "rollbar", "browserstack", "guix", "inferno", "gitkraken", "upwork", "dynatrace-icon", "dynatrace", "keystonejs", "section-icon", "section", "svgo-icon", "svgo-logo", "mastercard", "gocd", "chromatic-icon", "chromatic", "concrete5", "cloud9", "keybase", "graphcool", "vivaldi-logo", "vivaldi", "capacitorjs-icon", "capacitorjs", "digital-ocean", "api-ai", "reveal", "osquery", "mixpanel", "percona", "shields", "codacy", "fastly", "impala", "linkerd", "typeform-icon", "typeform", "elementary", "alibaba-cloud", "grape", "t3", "jfrog", "mailjet", "viber-logo", "viber", "buck", "grove", "pd-icon", "whatwg", "emmet", "gitter", "c-plusplus", "gecko", "youtrack", "codeship", "runnable", "jsdelivr", "caffe2", "loom", "maestro", "quay", "zeplin", "iron-icon", "iron", "browserslist", "fontforge", "cssnext", "oreilly", "adyen", "bitnami", "sparkpost", "taiga", "saucelabs", "struts", "webix-icon", "webix", "ycombinator", "html-5", "zulip-logo", "zulip", "hoa", "apple-pay", "sencha", "spree", "bourbon", "lighttpd", "desk", "marionette", "webhint-icon", "webhint", "close", "waffle", "postgraphile", "treehouse", "codepush", "rum", "sherlock-logo", "sherlock", "webtask", "zenhub-logo", "zenhub", "producthunt", "modernizr", "optimizely", "serveless", "basecamp", "jspm", "apiary", "riak", "wicket-icon", "wicket", "cobalt", "kemal", "mandrill", "marko", "mention", "opsgenie", "broccoli", "lastpass-icon", "lastpass-logo", "css-3", "html5-boilerplate", "xero", "egghead", "milligram", "percy-logo", "percy", "r-lang", "behance-icon", "behance", "squarespace", "authy", "mist", "hotjar", "invision-logo", "invision", "octopus-deploy", "stetho", "lynda", "torus", "cloudacademy-logo", "cloudacademy", "trac", "xtend", "flannel", "webmin", "otto", "rubymine", "wercker", "filezilla", "glimmerjs", "deviantart", "buddy", "floydhub", "pipedrive", "rxdb", "airbrake", "seneca", "pingdom", "weave", "monday-icon", "monday", "bytedance-logo", "bytedance", "rackspace", "stitch", "cross-browser-testing", "envato", "glamorous", "rkt", "sourcetree", "kuaishou-icon", "kuaishou-logo", "mesosphere", "sourcegraph", "appdynamics", "conan-io", "sysdig-logo", "sysdig", "doubleclick", "eventbrite-icon", "eventbrite", "semaphoreci", "moltin-icon", "moltin", "cachet", "amex", "jelastic-logo", "jelastic", "jsfiddle", "amazon-connect", "ceylon", "delicious", "watchman", "loggly", "qzone", "unionpay", "fuchsia", "passbolt-logo", "passbolt", "raphael", "500px", "copyleft", "new-relic", "tectonic", "user-testing-icon", "user-testing", "evergreen-icon", "evergreen", "memsql-icon", "memsql", "vwo", "solarwinds", "blossom", "mapzen-logo", "mapzen", "nodeos", "susy", "upcase", "logentries", "turret", "autocode", "braze", "dreamhost", "mio", "nodebots", "orchid-logo", "orchid", "rax", "reindex", "vernemq", "vine", "forever", "armory", "game-analytics-logo", "game-analytics", "helpscout-logo", "helpscout", "stoplight", "webplatform", "chargebee-icon", "chargebee", "jcb", "morpheus-logo", "morpheus", "appcode", "drip", "wpengine", "dashlane-logo", "dashlane", "myth", "nuclide", "poeditor", "tutsplus", "agpl_v3", "chevereto", "esdoc", "kinvey", "mootools", "swiftype", "falcor", "opencollective", "pipefy", "scaledrone", "canjs", "codrops", "hoodie", "infer", "losant", "flat-ui", "heron", "litmus", "nanonets", "pagekit", "sidekick", "unito-logo", "unito", "ampersand", "cirrus", "codeschool", "microcosm", "astronomer", "internetexplorer", "kontena", "sugarss", "cirrus-ci", "crucible", "kore", "mageia", "tsuru", "octodns", "picasa", "plastic-scm", "protactor", "xwiki-icon", "xwiki", "yammer", "zorin-os", "appbaseio-icon", "appbaseio", "eager", "librato", "qwant-logo", "qwant", "rsmq", "scribd-icon", "scribd", "sitepoint", "stacksmith", "appsignal-icon", "appsignal", "fomo", "jsbin", "parsehub", "rocket-chat-logo", "rocket-chat", "shipit", "supersonic", "tsu", "apostrophe", "campfire", "codefactor-logo", "codefactor", "gomix", "nuodb", "shippable", "shogun", "react-styleguidist", "appbase", "gfdl", "liftweb", "stormpath", "treasuredata-logo", "treasuredata", "zest", "blocs", "customerio-logo", "customerio", "kinto-logo", "kinto", "mixmax", "nodewebkit", "podio", "puppy-linux", "steroids", "tealium", "celluloid", "keen", "keycdn-logo", "keycdn", "krakenjs", "speakerdeck", "strider", "web-fundamentals", "apache_cloudstack", "codebeat", "codersrank", "enyo", "glint", "kitematic", "skylight", "snap-svg", "victorops", "wmr", "bigpanda", "cloudlinux", "dojo-toolkit", "envoyer", "fluxxor", "lateral", "opbeat", "runscope", "targetprocess", "tunein", "dreamfactory", "frontapp", "madge", "prospect", "pyup", "scaphold", "smashingmagazine", "supergiant", "uservoice-logo", "uservoice", "apple-app-store", "botanalytics", "carbide", "cloudcraft", "codio", "eta-lang", "gordon", "magneto", "mparticle-logo", "mparticle", "nodal", "smartling", "stackshare", "stylefmt", "thimble", "umu", "bosun", "dimer", "embedly", "fleep-logo", "fleep", "forestadmin-logo", "forestadmin", "galliumos", "kissmetrics", "maxthon", "siphon", "unbounce-logo", "unbounce", "woopra-logo", "woopra", "workato-icon", "wufoo", "xcart", "adroll", "angellist", "campaignmonitor-icon", "campaignmonitor", "coderwall", "day-js", "deployhq", "ebanx", "flattr-logo", "flattr", "flocker", "gusto", "hostgator-logo", "hostgator", "houndci", "kustomer", "logmatic", "lookback", "mockflow", "styleci", "svgator", "tnw", "tutum", "weebly", "amazon-chime", "apitools", "componentkit", "containership", "convox", "dinersclub", "flyjs", "geekbot", "giantswarm", "gitup", "gratipay", "haxl", "leankit-icon", "leankit", "pagekite", "pepperoni", "productboard-logo", "productboard", "protonet", "quobyte", "speedcurve", "appfog", "apptentive", "codefund-icon", "codefund", "crateio", "dapulse", "designernews", "elemental-ui", "flowxo", "gohorse", "kallithea", "kloudless", "linux-tux", "maps-me", "maxcdn", "olark", "pingy", "precursor", "proofy", "sourcetrail", "tastejs", "ucbrowser", "workboard", "zube", "daemon-tools", "delighted-logo", "delighted", "dockbit", "engine-yard-logo", "engine-yard", "eventsentry", "formkeep", "groovehq", "harrow", "hipercard", "humongous", "importio", "launchkit", "manifoldjs", "netuitive", "positionly", "protoio-logo", "protoio", "redsmin", "sagui", "survicate", "tapcart-logo", "tapcart", "vaddy", "visaelectron", "x-ray-goggles", "100tb", "alpinejs-icon-circle", "apache-openoffice-icon", "apache-openoffice-logo", "apollostack", "appcircle-icon", "appcircle", "apphub", "appmaker", "apportable", "aurous", "backerkit", "baker-street", "basekit", "bem-2", "bitballoon", "booqable", "bowtie", "branch", "brandfolder-icon", "brandfolder", "browserling", "bugherd", "bugsee", "changetip", "chartblocks", "clickdeploy", "clusterhq", "codepicnic", "copyleft-pirate", "css-3_official", "database-labs", "dependencyci", "deppbot", "dropmark", "elasticbox", "ello", "ember-tomster", "ethnio", "fabric_io", "firefox_classic", "flexible-gs", "floodio", "freedcamp-icon", "freedcamp", "freedomdefined", "g-ads", "g-adsense", "g-adword", "g-analytics", "g-tag-manager", "gaugeio", "get-satisfaction", "getyourguide", "gitboard", "github-octocat", "gpl_v3", "hacker-one", "heroku-redis", "hosted-graphite", "instagram-icon-monochrome", "itsalive-icon", "itsalive", "kali-dragon-icon", "khan_academy-logo", "khan_academy", "koreio", "launchrock", "leafjet", "lets-cloud", "lgpl_v3", "livewire-underwater-jelly", "locent", "lucene.net", "mailchimp-freddie", "maildeveloper", "mandrill-shield", "mantl", "medium-icon-circle", "neonmetrics", "nodejitsu", "noysi", "npm-2", "olapic", "opsee", "orchid-monochrome", "peer5", "perf-rocks", "phonegap-bot", "php-alt", "pivotal_tracker", "pixate", "planless-logo", "planless", "prott", "pumpkindb", "qordoba", "reapp", "recast.ai", "redspread", "remergr", "rest-li", "run-above", "sameroom", "samsung_internet", "sass-doc", "sectionio", "sina_weibo", "skaffolder", "sninnaker", "snupps", "socket.io", "sparkcentral", "sqldep", "stickermule", "supportkit", "svg-withtext", "taskade-icon", "taskade", "teamgrid", "testlodge", "testmunk", "titon", "tor_browser", "traackr", "travis-ci-monochrome", "unitjs", "v8-ignition", "v8-turbofan", "vector-timber", "visual_website_optimizer", "whalar", "wikimedia_commons", "wiredtree", "workato-wordmark", "xplenty", "yandex-ru", "yandex_browser"];
    // let list = ["javascript"];
    
    let mut meta_data = MetaData {
        items: Vec::new(),
    };
    for ll in list {
        let root = get_path("repo/geticon/icons");
        let path = format!("{}/{}.svg", root, ll);
        if fs::exists(path).unwrap() {
        } else {
            panic!("icon not found: {}", ll);
        }
    }
    for ll in list {
        println!("parse: {}", ll);
        // build_resouce(ll);
        let data = get_svg_bytes(ll).unwrap();
        let (pix, scale) = techwall::png::convert_svg_to_png(data).unwrap();
        let w = pix.width() / 10;
        let h = pix.height() / 10;
        let content = pix.encode_png().unwrap();
        // std::fs::write(format!("{}/{}/icon.png", root, ll), &content).unwrap();
        let _content = techwall::png::load(&content, (w as usize,h as usize)).unwrap();
        let polygon = _content.iter().map(|f|Point::from(*f)).collect();
        let meta = Meta {
            width: pix.width(),
            height: pix.height(),
            scale,
            name: ll.to_string(),
            polygon,
        };
        meta_data.items.push(meta);
        std::fs::write(format!("{}/{}.png", target, ll), &content).unwrap();
    }
    
    let json_conten = serde_json::to_string(&meta_data).unwrap();
    // let file = File::create(format!("{}/meta", target)).unwrap();
    let data = json_conten.as_bytes();
    let mut encoder = GzEncoder::new(Vec::new(), Compression::default());
    encoder.write_all(data).unwrap();
    let content = encoder.finish().unwrap();
    std::fs::write(format!("{}/meta", target), content).unwrap();
}
